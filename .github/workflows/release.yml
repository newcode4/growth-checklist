name: Build & Release
on:
  push:
    tags:
      - '*'

# 🔑 필수: 릴리스 생성/업로드 권한
permissions:
  contents: write

jobs:
  build-release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with: { fetch-depth: 0 }

      - name: Make zip (growth-checklist only)
        run: |
          set -e
          mkdir -p pkg
          rsync -a --delete ./ pkg/growth-checklist \
            --exclude ".git" \
            --exclude ".github" \
            --exclude "node_modules" \
            --exclude "*.zip"
          cd pkg
          zip -r "growth-checklist-${GITHUB_REF_NAME}.zip" "growth-checklist"
          ls -l

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ github.ref_name }}
          name: ${{ github.ref_name }}
          body: "Release ${{ github.ref_name }}"
          files: pkg/growth-checklist-${{ github.ref_name }}.zip
